# üìö SISTEMA DE PERIODOS ACAD√âMICOS - DOCUMENTACI√ìN COMPLETA
## Versi√≥n Optimizada

---

## üìñ √çNDICE
1. [Resumen Ejecutivo](#resumen-ejecutivo)
2. [Estructura de Base de Datos](#estructura-de-base-de-datos)
3. [Flujo Completo del Sistema](#flujo-completo-del-sistema)
4. [Casos de Uso](#casos-de-uso)
5. [Interfaces de Usuario](#interfaces-de-usuario)
6. [Implementaci√≥n T√©cnica](#implementaci√≥n-t√©cnica)

---

## 1. RESUMEN EJECUTIVO

### Objetivo
Implementar un sistema divisor por periodos o trimestres acad√©micos donde:
- Al final de cada trimestre hay un cierre de notas
- Se puede iniciar un nuevo trimestre/periodo
- El administrador gestiona fechas l√≠mite
- Notificaciones autom√°ticas a usuarios (inicio/fin de periodos)
- Finalizaci√≥n del ciclo escolar con promoci√≥n autom√°tica de estudiantes
- Generaci√≥n de reportes (notas, asistencias, etc.)

### Decisiones de Dise√±o
- ‚úÖ **Solo 2 tablas nuevas:** `ciclo_academico` y `periodo_academico`
- ‚úÖ **Reutilizar tablas existentes:** Se extienden 5 tablas con nuevos campos
- ‚úÖ **Sin tablas redundantes:** Usa `Notificacion` y `ReporteCalificaciones` existentes
- ‚úÖ **Historial integrado:** La tabla `matricula` ahora guarda historial completo

---

## 2. ESTRUCTURA DE BASE DE DATOS

### 2.1 NUEVAS TABLAS (Solo 2)

#### A) Tabla: `ciclo_academico`
**Prop√≥sito:** Representa el a√±o escolar completo (ej: 2024-2025)

```python
class CicloAcademico(db.Model):
    __tablename__ = 'ciclo_academico'
    
    id_ciclo = db.Column(db.Integer, primary_key=True)
    nombre = db.Column(db.String(100), nullable=False)
    fecha_inicio = db.Column(db.Date, nullable=False)
    fecha_fin = db.Column(db.Date, nullable=False)
    estado = db.Column(db.Enum('planificado', 'activo', 'cerrado'), default='planificado')
    activo = db.Column(db.Boolean, default=False)
    fecha_creacion = db.Column(db.DateTime, default=datetime.utcnow)
    
    # Relaciones
    periodos = relationship('PeriodoAcademico', back_populates='ciclo')
    matriculas = relationship('Matricula', back_populates='ciclo_academico')
    notificaciones = relationship('Notificacion', back_populates='ciclo_academico')
    reportes = relationship('ReporteCalificaciones', back_populates='ciclo_academico')
```

**Ejemplo:**
```
id: 1
nombre: "A√±o Escolar 2024-2025"
fecha_inicio: 2024-02-05
fecha_fin: 2024-11-30
estado: activo
activo: True
```

---

#### B) Tabla: `periodo_academico`
**Prop√≥sito:** Representa cada trimestre/periodo dentro del ciclo

```python
class PeriodoAcademico(db.Model):
    __tablename__ = 'periodo_academico'
    
    id_periodo = db.Column(db.Integer, primary_key=True)
    ciclo_academico_id = db.Column(db.Integer, db.ForeignKey('ciclo_academico.id_ciclo'))
    numero_periodo = db.Column(db.Integer, nullable=False)  # 1, 2, 3
    nombre = db.Column(db.String(100), nullable=False)
    fecha_inicio = db.Column(db.Date, nullable=False)
    fecha_fin = db.Column(db.Date, nullable=False)
    fecha_cierre_notas = db.Column(db.Date, nullable=False)
    estado = db.Column(db.Enum('planificado', 'activo', 'en_cierre', 'cerrado'), default='planificado')
    dias_notificacion_anticipada = db.Column(db.Integer, default=7)
    fecha_creacion = db.Column(db.DateTime, default=datetime.utcnow)
    
    # Relaciones
    ciclo = relationship('CicloAcademico', back_populates='periodos')
    calificaciones = relationship('Calificacion', back_populates='periodo_academico')
    asistencias = relationship('Asistencia', back_populates='periodo_academico')
    notificaciones = relationship('Notificacion', back_populates='periodo_academico')
    reportes = relationship('ReporteCalificaciones', back_populates='periodo_academico')
```

**Ejemplo:**
```
Periodo 1: "Primer Trimestre"
  fecha_inicio: 2024-02-05, fecha_fin: 2024-05-10
  fecha_cierre_notas: 2024-05-08
  dias_notificacion: 7, estado: activo

Periodo 2: "Segundo Trimestre"
  fecha_inicio: 2024-05-13, fecha_fin: 2024-08-16
  estado: planificado

Periodo 3: "Tercer Trimestre"
  fecha_inicio: 2024-08-19, fecha_fin: 2024-11-30
  estado: planificado
```

---

### 2.2 TABLAS EXTENDIDAS (5 tablas)

#### C) `matricula` - Nuevos campos

```python
# ‚úÖ NUEVOS CAMPOS AGREGADOS:
ciclo_academico_id = db.Column(db.Integer, db.ForeignKey('ciclo_academico.id_ciclo'), nullable=True)
estado_matricula = db.Column(db.Enum('activa', 'inactiva', 'finalizada', 'retirada'), default='activa')
promedio_final = db.Column(db.Numeric(5,2), nullable=True)
estado_promocion = db.Column(db.Enum('aprobado', 'reprobado', 'graduado', 'en_curso', 'retirado'), nullable=True)
curso_promocion_id = db.Column(db.Integer, db.ForeignKey('curso.id_curso'), nullable=True)
fecha_promocion = db.Column(db.DateTime, nullable=True)
observaciones_cierre = db.Column(db.Text, nullable=True)

# Relaciones
ciclo_academico = relationship('CicloAcademico', back_populates='matriculas')
curso_promocion = relationship('Curso', foreign_keys=[curso_promocion_id])
```

**Prop√≥sito:** Ahora guarda historial acad√©mico completo (aprob√≥/reprob√≥, promoci√≥n)

**Evoluci√≥n de datos:**
```
INICIO CICLO:
  estudiante_id: 10, curso_id: 5 (10¬∞ A), estado: activa, promocion: en_curso

FIN CICLO (aprueba):
  promedio_final: 4.2, estado: finalizada, promocion: aprobado
  curso_promocion_id: 6 (11¬∞ A)

NUEVO CICLO:
  estudiante_id: 10, curso_id: 6 (11¬∞ A), estado: activa
```

---

#### D) `calificacion` - Nuevo campo

```python
# ‚úÖ NUEVO CAMPO:
periodo_academico_id = db.Column(db.Integer, db.ForeignKey('periodo_academico.id_periodo'), nullable=True)
periodo_academico = relationship('PeriodoAcademico', back_populates='calificaciones')
```

**Prop√≥sito:** Cada nota est√° vinculada a un periodo espec√≠fico

---

#### E) `asistencia` - Nuevo campo

```python
# ‚úÖ NUEVO CAMPO:
periodo_academico_id = db.Column(db.Integer, db.ForeignKey('periodo_academico.id_periodo'), nullable=True)
periodo_academico = relationship('PeriodoAcademico', back_populates='asistencias')
```

---

#### F) `notificacion` - Nuevos campos

```python
# ‚úÖ NUEVOS CAMPOS:
periodo_academico_id = db.Column(db.Integer, db.ForeignKey('periodo_academico.id_periodo'), nullable=True)
ciclo_academico_id = db.Column(db.Integer, db.ForeignKey('ciclo_academico.id_ciclo'), nullable=True)
tipo_evento = db.Column(db.Enum('inicio_periodo', 'proximidad_cierre', 'cierre_periodo', 
                                 'inicio_ciclo', 'fin_ciclo', 'promocion'), nullable=True)
programada_para = db.Column(db.DateTime, nullable=True)
enviada = db.Column(db.Boolean, default=False)

# Relaciones
periodo_academico = relationship('PeriodoAcademico', back_populates='notificaciones')
ciclo_academico = relationship('CicloAcademico', back_populates='notificaciones')
```

**Ejemplos de notificaciones:**
- Inicio de periodo
- Recordatorio de cierre (X d√≠as antes)
- Cierre de periodo
- Resultados de promoci√≥n

---

#### G) `ReporteCalificaciones` - Nuevos campos

```python
# ‚úÖ NUEVOS CAMPOS:
periodo_academico_id = db.Column(db.Integer, db.ForeignKey('periodo_academico.id_periodo'), nullable=True)
ciclo_academico_id = db.Column(db.Integer, db.ForeignKey('ciclo_academico.id_ciclo'), nullable=True)
tipo_reporte = db.Column(db.Enum('periodo', 'ciclo_completo', 'notas', 'asistencias', 
                                  'general', 'promocion', 'curso', 'estudiante'), nullable=True)
formato_archivo = db.Column(db.Enum('pdf', 'excel', 'csv'), nullable=True)
ruta_archivo = db.Column(db.String(500), nullable=True)
nombre_archivo = db.Column(db.String(200), nullable=True)
generado_por_id = db.Column(db.Integer, db.ForeignKey('usuarios.id_usuario'), nullable=True)
```

**Tipos de reportes:**
- Por periodo (curso/asignatura)
- Ciclo completo (certificados)
- Asistencias
- Promoci√≥n general

---

## 3. FLUJO COMPLETO DEL SISTEMA

### FASE 1: Configuraci√≥n Inicial (Admin)

```
1. Admin crea Ciclo Acad√©mico
   ‚îî‚îÄ> "A√±o Escolar 2024-2025" (05/02/2024 - 30/11/2024)

2. Admin crea 3 Periodos
   ‚îú‚îÄ> Periodo 1: 05/02 - 10/05/2024
   ‚îú‚îÄ> Periodo 2: 13/05 - 16/08/2024
   ‚îî‚îÄ> Periodo 3: 19/08 - 30/11/2024

3. Admin activa el Ciclo
   ‚îî‚îÄ> Sistema activa Periodo 1 autom√°ticamente
       Sistema env√≠a notificaci√≥n de inicio a todos
```

### FASE 2: Durante el Periodo

```
PROFESORES:
‚îú‚îÄ> Registran asistencias (vinculadas al periodo actual)
‚îú‚îÄ> Ingresar notas (vinculadas al periodo actual)
‚îî‚îÄ> Reciben notificaci√≥n: "Cierre en 7 d√≠as"

ESTUDIANTES/PADRES:
‚îú‚îÄ> Consultan notas del periodo actual
‚îî‚îÄ> Ven asistencias del periodo

SISTEMA (Autom√°tico):
‚îú‚îÄ> 7 d√≠as antes ‚Üí Notifica a profesores
‚îî‚îÄ> Fecha de cierre ‚Üí Notifica cierre
```

### FASE 3: Cierre de Periodo (Admin)

```
Admin: "Cerrar Periodo 1"

Sistema ejecuta:
1. Valida que todas las notas est√©n ingresadas
2. Calcula promedios del periodo
3. Genera reportes (PDF, Excel)
4. Cambia estado a "cerrado"
5. Bloquea edici√≥n de notas del periodo
6. Activa Periodo 2
7. Notifica inicio del nuevo periodo
```

### FASE 4: Finalizaci√≥n de Ciclo (Admin)

```
Admin: "Finalizar A√±o Escolar"

Sistema ejecuta:
1. Cierra √∫ltimo periodo (si no est√° cerrado)

2. Calcula promedios finales por estudiante

3. Proceso de Promoci√≥n:
   Para cada estudiante:
     SI promedio >= nota_minima:
       - Actualiza matr√≠cula: finalizada, aprobado
       - Crea nueva matr√≠cula en curso superior
       - Notifica: "Promovido a 11¬∞"
     
     SI NO:
       - Actualiza matr√≠cula: finalizada, reprobado
       - Crea nueva matr√≠cula en mismo curso
       - Notifica: "Debe repetir grado"

4. Genera reportes finales:
   ‚îú‚îÄ> Certificados individuales (PDF)
   ‚îú‚îÄ> Reporte de promoci√≥n (Excel)
   ‚îî‚îÄ> Estad√≠sticas generales (Excel)

5. Cierra ciclo: estado = "cerrado"

6. Notifica resultados a todos
```

---

## 4. CASOS DE USO

### Caso 1: Consultar notas hist√≥ricas

**Padre quiere ver notas del Periodo 1:**
```sql
SELECT * FROM calificacion 
WHERE estudianteId = 10 
AND periodo_academico_id = 1
```

**Ver notas de todo el a√±o:**
```sql
SELECT * FROM calificacion c
JOIN periodo_academico p ON c.periodo_academico_id = p.id_periodo
WHERE c.estudianteId = 10 
AND p.ciclo_academico_id = 1
```

### Caso 2: Estudiante repite y luego aprueba

```
A√ëO 2024 (Ciclo 1) - REPRUEBA:
‚îú‚îÄ> Matricula: curso 10¬∞ A, promedio: 2.5
‚îî‚îÄ> estado_promocion: "reprobado"

A√ëO 2025 (Ciclo 2) - APRUEBA:
‚îú‚îÄ> Nueva Matricula: curso 10¬∞ A (repite)
‚îî‚îÄ> promedio: 4.0, promocion: "aprobado"

A√ëO 2026 (Ciclo 3):
‚îî‚îÄ> Nueva Matricula: curso 11¬∞ A
```

### Caso 3: Generar certificado individual

```python
1. Buscar matr√≠cula del estudiante en el ciclo
2. Obtener notas de todos los periodos
3. Calcular promedios por periodo
4. Generar PDF con:
   - Datos del estudiante
   - Notas por asignatura y periodo
   - Promedio final
   - Resultado: APROBADO/REPROBADO
5. Guardar en ReporteCalificaciones
```

---

## 5. INTERFACES DE USUARIO

### Panel del Administrador

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GESTI√ìN DE CICLOS Y PERIODOS           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üìÖ Ciclo Actual: A√±o 2024-2025         ‚îÇ
‚îÇ     Estado: ‚óè Activo                    ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  PERIODOS:                              ‚îÇ
‚îÇ  ‚úì Periodo 1: CERRADO [Ver Reportes]   ‚îÇ
‚îÇ  ‚óè Periodo 2: ACTIVO [Cerrar Periodo]   ‚îÇ
‚îÇ  ‚óã Periodo 3: PLANIFICADO              ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  [üîî Notificaciones]                    ‚îÇ
‚îÇ  [üìä Estad√≠sticas]                      ‚îÇ
‚îÇ  [üèÅ Finalizar A√±o Escolar]             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Panel del Profesor

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  NOTAS - Matem√°ticas 10¬∞ A             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Periodo: [‚ñº Periodo 2 (Activo)]        ‚îÇ
‚îÇ  ‚ö†Ô∏è Cierre: 14/08/2024 (en 10 d√≠as)    ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  [Tabla de notas por estudiante]        ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  üìú Ver hist√≥rico: [Periodo 1‚ñº]         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Panel del Padre/Estudiante

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  CALIFICACIONES - Juan P√©rez            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Periodo: [‚ñº Periodo 2 (Activo)]        ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  Matem√°ticas - Promedio: 4.3            ‚îÇ
‚îÇ  Espa√±ol - Promedio: 4.0                ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  HIST√ìRICO:                             ‚îÇ
‚îÇ  Periodo 1: 4.4 [Ver detalle]           ‚îÇ
‚îÇ  Periodo 2: En curso...                 ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  [üìÑ Descargar Bolet√≠n]                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 6. IMPLEMENTACI√ìN T√âCNICA

### 6.1 Archivos a Crear/Modificar

**Nuevos archivos:**
```
controllers/models.py - Agregar 2 nuevas tablas + extender 5 existentes
routes/admin_periodos.py - Rutas para gesti√≥n de ciclos/periodos
services/periodo_service.py - L√≥gica de negocios
services/promocion_service.py - L√≥gica de promoci√≥n autom√°tica
services/reporte_service.py - Generaci√≥n de reportes
templates/admin/periodos/ - Interfaces de admin
```

**Modificar:**
```
routes/profesor.py - Agregar selector de periodo
routes/padres.py - Agregar consulta por periodo
templates/profesor/* - Agregar selector de periodo
templates/padres/* - Agregar selector de periodo
```

### 6.2 Servicios Principales

**periodo_service.py:**
- `crear_ciclo()`
- `crear_periodo()`
- `activar_ciclo()`
- `cerrar_periodo()`
- `obtener_periodo_activo()`

**promocion_service.py:**
- `calcular_promedio_final()`
- `procesar_promocion()`
- `promover_estudiante()`
- `finalizar_ciclo()`

**reporte_service.py:**
- `generar_reporte_periodo()`
- `generar_certificado_individual()`
- `generar_reporte_promocion()`
- `generar_estadisticas_ciclo()`

### 6.3 Notificaciones Autom√°ticas

**Proceso automatizado (Celery/Cron):**
```python
# Verificar diariamente:
1. ¬øHay periodo que inicia hoy? ‚Üí Notificar
2. ¬øHay cierre en X d√≠as? ‚Üí Notificar a profesores
3. ¬øHay notificaciones programadas? ‚Üí Enviar
```

---

## 7. VENTAJAS DEL SISTEMA

‚úÖ **Solo 2 tablas nuevas** - M√≠nima complejidad  
‚úÖ **Reutiliza infraestructura** - Usa tablas existentes  
‚úÖ **Historial completo** - Toda la trayectoria en `matricula`  
‚úÖ **Consultas eficientes** - Menos joins  
‚úÖ **Automatizaci√≥n** - Notificaciones y promoci√≥n autom√°ticas  
‚úÖ **Flexible** - Soporta bimestres/trimestres/cuatrimestres  
‚úÖ **Escalable** - F√°cil agregar funcionalidades  
‚úÖ **Trazabilidad** - Reportes detallados  

---

## 8. PR√ìXIMOS PASOS

1. ‚úÖ Revisar y aprobar este dise√±o
2. Crear modelos en `models.py`
3. Crear migraci√≥n de base de datos
4. Implementar servicios de l√≥gica
5. Crear rutas del admin
6. Crear interfaces de usuario
7. Implementar notificaciones autom√°ticas
8. Pruebas completas
9. Documentaci√≥n de usuario

---

**Fecha de creaci√≥n:** Octubre 2024  
**Versi√≥n:** 1.0 Optimizada  
**Estado:** Propuesta para aprobaci√≥n

