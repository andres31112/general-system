<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestiÃ³n de Usuarios/Roles</title>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/superadmin/gestion_usuarios/profesores.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/superadmin/gestion_inventario/equipos.css') }}">
</head>

<body>
    {% extends "base.html" %}
    {% block content %}
    <header class="main-header">
        <a onclick="history.back()" class="btn btn-outline-secondary btn-sm border-0 me-3">
            <i class="fa-solid fa-arrow-left"></i>
        </a>
        <h1>Gestion Inventario</h1>
        <div class="header-icons">
            <i class="fa-solid fa-bell"></i>
            <i class="fa-solid fa-user"></i>
        </div>
    </header>

    <main class="container-fluid p-4">
        <!--Tarjetas-->
        <section class="row mb-3">
            <div class="col-lg-4 col-md-6 mb-3">
                <div class="summary-card">
                    <div class="icon">
                        <i class="fa-solid fa-desktop"></i>
                    </div>
                    <h3 class="h6 mb-0">Total equipos</h3>
                    <p class="number mb-0" id="total-equipos">0</p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 mb-3">
                <div class="summary-card">
                    <div class="icon">
                        <i class="fa-solid fa-circle-check"></i>
                    </div>
                    <h3 class="h6 mb-0">Equipos Disponibles</h3>
                    <p class="number mb-0" id="total-equipos">0</p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 mb-3">
                <div class="summary-card">
                    <div class="icon">
                        <i class="fa-solid fa-screwdriver-wrench"></i>
                    </div>
                    <h3 class="h6 mb-0">Mantenimiento</h3>
                    <p class="number mb-0" id="total-equipos">0</p>
                </div>
            </div>
        </section>
    </main>
    <main class="row">
        <div class="container-fluid">
            <div class="row">
                
                <!-- ðŸ“Œ Tabla principal de equipos -->
                <div class="col-md-9 col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Equipos Registrados</h5>
                    <div>
                        <button class="btn btn-light btn-sm" onclick="mostrarTodosLosEquipos()">Ver Todos</button>
                        <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalAgregar">âž• Agregar Equipo</button>
                    </div>
                    </div>
                    <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover align-middle text-center">
                        <thead class="table-dark">
                            <tr>
                            <th>Equipo</th>
                            <th>Estado</th>
                            <th>Sede</th>
                            <th>Sala</th>
                            <th>Asignado a</th>
                            <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaEquiposGlobal"></tbody>
                        </table>
                    </div>
                    </div>
                </div>
                </div>

                <!-- ðŸ“Œ Tabla lateral de sedes y salas -->
                <div class="col-md-3 col-12">
                <div class="card shadow-sm salas-card">
                    <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs">
                        <li class="nav-item">
                        <a class="nav-link active" id="tab-sedeA" href="#" onclick="mostrarSede(1)">Sede A</a>
                        </li>
                        <li class="nav-item">
                        <a class="nav-link" id="tab-sedeB" href="#" onclick="mostrarSede(2)">Sede B</a>
                        </li>
                    </ul>
                    </div>
                    <div class="card-body p-2">
                    <div id="contenedorSede">
                        <div class="table-responsive">
                        <table class="table table-sm table-hover align-middle text-center">
                            <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Sala</th>
                            </tr>
                            </thead>
                            <tbody id="tablaSalas"></tbody>
                        </table>
                        </div>
                    </div>
                    </div>
                </div>
                </div>

            </div>
            </div>

            <!-- ðŸ“Œ Modal Agregar Equipo -->
            <div class="modal fade" id="modalAgregar" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Agregar Nuevo Equipo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formAgregar">
                    <div class="mb-2">
                        <label class="form-label">Nombre del Equipo</label>
                        <input type="text" id="nuevoNombre" class="form-control" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Estado</label>
                        <select id="nuevoEstado" class="form-select">
                        <option>Disponible</option>
                        <option>Mantenimiento</option>
                        <option>Asignado</option>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Sede</label>
                        <select id="nuevoSede" class="form-select" onchange="cargarSalas(this.value)" required>
                        <option value="">Seleccione Sede</option>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Sala</label>
                        <select id="nuevoSala" class="form-select" required></select>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Asignado a</label>
                        <input type="text" id="nuevoEstudiante" class="form-control">
                    </div>
                    <button type="submit" class="btn btn-success w-100">Registrar Equipo</button>
                    </form>
                </div>
                </div>
            </div>
            </div>
    </main>
    <script src="{{ url_for('static', filename='js/superadmin/profesores.js') }}"></script>
    <script>
        /* ðŸ“Œ Datos simulados (como si vinieran del localhost) */
        let sedes = [
        { id: 1, nombre: "Sede A", salones: [
            { id: 101, nombre: "Aula 101", tipo: "Aula", equipos: [
                { nombre:"PC-01", estado:"Disponible", estudiante:"Juan" },
                { nombre:"PC-02", estado:"Mantenimiento", estudiante:"" }
            ]},
            { id: 102, nombre: "Lab Computo 1", tipo: "Sala de CÃ³mputo", equipos: [
                { nombre:"PC-03", estado:"Disponible", estudiante:"Maria" }
            ]}
        ]},
        { id: 2, nombre: "Sede B", salones: [
            { id: 201, nombre: "Aula 201", tipo: "Aula", equipos: [] },
            { id: 202, nombre: "Lab Computo 2", tipo: "Sala de CÃ³mputo", equipos: [
                { nombre:"PC-04", estado:"Disponible", estudiante:"Pedro" }
            ]}
        ]}
        ];

        /* ðŸ“Œ Render equipos en tabla principal */
        function actualizarTablaEquipos(equipos, sedeNombre, salaNombre) {
        const tbody = document.getElementById("tablaEquiposGlobal");
        tbody.innerHTML = "";

        equipos.forEach(eq => {
            const row = `
            <tr>
                <td>${eq.nombre}</td>
                <td>${eq.estado}</td>
                <td>${sedeNombre}</td>
                <td>${salaNombre}</td>
                <td>${eq.estudiante || "-"}</td>
                <td>
                <button class="btn btn-info btn-sm">Ver</button>
                <button class="btn btn-warning btn-sm">Editar</button>
                </td>
            </tr>
            `;
            tbody.innerHTML += row;
        });
        }

        /* ðŸ“Œ Mostrar todos los equipos */
        function mostrarTodosLosEquipos() {
        const tbody = document.getElementById("tablaEquiposGlobal");
        tbody.innerHTML = "";

        sedes.forEach(sede => {
            sede.salones.forEach(salon => {
            salon.equipos.forEach(eq => {
                const row = `
                <tr>
                    <td>${eq.nombre}</td>
                    <td>${eq.estado}</td>
                    <td>${sede.nombre}</td>
                    <td>${salon.nombre}</td>
                    <td>${eq.estudiante || "-"}</td>
                    <td>
                    <button class="btn btn-info btn-sm">Ver</button>
                    <button class="btn btn-warning btn-sm">Editar</button>
                    </td>
                </tr>
                `;
                tbody.innerHTML += row;
            });
            });
        });
        }

        /* ðŸ“Œ Mostrar salas */
        function mostrarSede(sedeId) {
        document.getElementById("tab-sedeA").classList.remove("active");
        document.getElementById("tab-sedeB").classList.remove("active");
        if (sedeId === 1) document.getElementById("tab-sedeA").classList.add("active");
        if (sedeId === 2) document.getElementById("tab-sedeB").classList.add("active");

        const tbody = document.getElementById("tablaSalas");
        tbody.innerHTML = "";
        const sede = sedes.find(s => s.id == sedeId);

        sede.salones.forEach(salon => {
            const row = `
            <tr onclick="mostrarEquiposDeSala(${sede.id}, ${salon.id})">
                <td>${salon.id}</td>
                <td>${salon.nombre}</td>
            </tr>
            `;
            tbody.innerHTML += row;
        });
        }

        /* ðŸ“Œ Mostrar equipos de sala */
        function mostrarEquiposDeSala(sedeId, salaId) {
        const sede = sedes.find(s => s.id == sedeId);
        const salon = sede.salones.find(s => s.id == salaId);
        actualizarTablaEquipos(salon.equipos, sede.nombre, salon.nombre);
        }

        /* ðŸ“Œ Cargar sedes en formulario */
        function cargarSedes() {
        const select = document.getElementById("nuevoSede");
        sedes.forEach(s => {
            const opt = document.createElement("option");
            opt.value = s.id;
            opt.textContent = s.nombre;
            select.appendChild(opt);
        });
        }

        /* ðŸ“Œ Cargar salas segÃºn sede */
        function cargarSalas(sedeId) {
        const select = document.getElementById("nuevoSala");
        select.innerHTML = "";
        const sede = sedes.find(s => s.id == sedeId);
        if (sede) {
            sede.salones.forEach(salon => {
            const opt = document.createElement("option");
            opt.value = salon.id;
            opt.textContent = salon.nombre;
            select.appendChild(opt);
            });
        }
        }

        /* ðŸ“Œ Agregar equipo al arreglo */
        document.getElementById("formAgregar").addEventListener("submit", e => {
        e.preventDefault();
        const nombre = document.getElementById("nuevoNombre").value;
        const estado = document.getElementById("nuevoEstado").value;
        const sedeId = parseInt(document.getElementById("nuevoSede").value);
        const salaId = parseInt(document.getElementById("nuevoSala").value);
        const estudiante = document.getElementById("nuevoEstudiante").value;

        const sede = sedes.find(s => s.id === sedeId);
        const sala = sede.salones.find(s => s.id === salaId);

        // agregar el nuevo equipo
        sala.equipos.push({ nombre, estado, estudiante });

        // refrescar vista
        mostrarTodosLosEquipos();

        // cerrar modal
        bootstrap.Modal.getInstance(document.getElementById('modalAgregar')).hide();
        e.target.reset();
        });

        /* ðŸ“Œ Inicializar */
        mostrarTodosLosEquipos();
        mostrarSede(1);
        cargarSedes();
    </script>
    {% endblock%}

</body>

</html>